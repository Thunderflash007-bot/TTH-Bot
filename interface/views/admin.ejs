<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Control Panel - TTH-Bot</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* Animated Background */
        body {
            background: #0a0e27 !important;
            position: relative;
            overflow-x: hidden;
        }
        
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #2a1f3a 100%);
        }

        .animated-bg canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Admin Container */
        .admin-container {
            animation: fadeIn 0.6s ease-out;
            position: relative;
            z-index: 1;
        }

        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            animation: slideDown 0.5s ease-out;
            backdrop-filter: blur(10px);
        }
        
        .admin-card {
            background: rgba(20, 25, 45, 0.9) !important;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(102, 126, 234, 0.3);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            transition: all 0.3s;
            animation: fadeInUp 0.6s ease-out;
        }

        .admin-card h2,
        .admin-card h3,
        .admin-card h4,
        .admin-card p,
        .admin-card label,
        .admin-card span {
            color: white !important;
        }

        .admin-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
            background: rgba(25, 30, 50, 0.95) !important;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        .status-online { background: #57F287; color: #000; }
        .status-offline { background: #ED4245; color: #FFF; }
        .severity-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .severity-option {
            padding: 15px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(20, 25, 45, 0.6);
            color: white;
        }
        .severity-option:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.3);
            transform: scale(1.05);
        }
        .severity-option.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
        }
        .severity-info { border-color: #5865F2; }
        .severity-warning { border-color: #FEE75C; }
        .severity-critical { border-color: #ED4245; }
        .guild-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .guild-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .guild-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }
        .stat-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .stat-box:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(245, 87, 108, 0.4);
        }
        .stat-box h3 {
            font-size: 2.5em;
            margin: 10px 0;
            animation: countUp 0.5s ease-out;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes countUp {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Button Improvements */
        button, .btn {
            transition: all 0.3s;
        }

        button:hover, .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Input Improvements */
        input, select, textarea {
            background: rgba(26, 31, 58, 0.6) !important;
            border: 2px solid rgba(102, 126, 234, 0.3) !important;
            color: white !important;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #667eea !important;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
            outline: none;
        }

        /* Label Colors */
        label, h2, h3, h4, strong {
            color: white !important;
        }
        
        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: #ED4245;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .slider.round {
            border-radius: 34px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        
        /* Feature Toggle Items */
        .feature-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(20, 25, 45, 0.8);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-left-width: 4px;
            backdrop-filter: blur(10px);
        }
        .feature-item:hover {
            background: rgba(25, 30, 50, 0.9);
            border-color: #667eea;
        }
        .feature-item.disabled {
            border-left-color: #ED4245;
            opacity: 0.7;
        }
        .feature-info h4 {
            margin: 0 0 5px 0;
            color: white;
        }
        .feature-info p {
            margin: 0;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
        }
        .feature-toggle-switch .switch {
            width: 50px;
            height: 28px;
        }
        .feature-toggle-switch .slider:before {
            height: 20px;
            width: 20px;
        }
        .feature-toggle-switch input:checked + .slider {
            background-color: #57F287;
        }
        
        /* Bypass User Item */
        .bypass-user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(20, 25, 45, 0.7);
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-left-width: 4px;
            backdrop-filter: blur(10px);
        }
        .bypass-user-item:hover {
            background: rgba(25, 30, 50, 0.85);
            border-color: #667eea;
        }
        .bypass-user-item.current-user {
            border-left-color: #57F287;
            background: rgba(87, 242, 135, 0.15);
        }
        .bypass-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bypass-user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid #667eea;
        }
        .bypass-user-name {
            font-weight: 500;
            color: white;
        }
        .bypass-user-id {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            font-family: monospace;
        }
        .bypass-remove-btn {
            background: #ED4245;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        .bypass-remove-btn:hover {
            background: #c23739;
        }
        .bypass-remove-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <canvas id="particles"></canvas>
    </div>
    
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <i class="fas fa-crown"></i>
                <span>TTH-Bot Admin Panel</span>
            </div>
            <div class="nav-links">
                <a href="/dashboard" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Zur√ºck zum Dashboard
                </a>
                <a href="/auth/logout" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 30px; max-width: 1400px;">
        <!-- Admin Header -->
        <div class="admin-header">
            <h1><i class="fas fa-crown"></i> Admin Control Panel</h1>
            <p style="opacity: 0.9; margin-top: 10px;">
                <i class="fas fa-user-shield"></i> Eingeloggt als: <strong><%= user.username %></strong>
            </p>
            <p style="opacity: 0.8; margin-top: 5px; font-size: 14px;">
                <i class="fas fa-lock"></i> Dieser Bereich ist nur f√ºr dich sichtbar
            </p>
        </div>

        <!-- Bot Status -->
        <div class="admin-card">
            <h2><i class="fas fa-heartbeat"></i> Bot Status</h2>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                <div class="stat-box">
                    <i class="fas fa-robot" style="font-size: 2em;"></i>
                    <h3><%= botStatus.online ? 'Online' : 'Offline' %></h3>
                    <p>Bot Status</p>
                </div>
                <div class="stat-box">
                    <i class="fas fa-server" style="font-size: 2em;"></i>
                    <h3><%= botStatus.guilds ? botStatus.guilds.length : 0 %></h3>
                    <p>Server</p>
                </div>
                <div class="stat-box">
                    <i class="fas fa-clock" style="font-size: 2em;"></i>
                    <h3><%= botStatus.uptime || '0h' %></h3>
                    <p>Uptime</p>
                </div>
            </div>
        </div>

        <% if (isMainAdmin) { %>
        <!-- Admin User Verwaltung (nur f√ºr Haupt-Admin) -->
        <div class="admin-card" style="border: 3px solid #5865F2;">
            <h2><i class="fas fa-user-shield"></i> Admin-User Verwaltung</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                <i class="fas fa-crown" style="color: #5865F2;"></i>
                <strong>Haupt-Admin Bereich:</strong> Hier kannst du weitere Admins hinzuf√ºgen und deren Berechtigungen verwalten.
            </p>

            <!-- Admin hinzuf√ºgen -->
            <div style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="margin: 0 0 15px 0; color: white;">
                    <i class="fas fa-user-plus"></i> Neuen Admin hinzuf√ºgen
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="newAdminUserId" class="form-control" placeholder="User-ID eingeben" onkeypress="if(event.key==='Enter') addAdminUser()">
                    <input type="text" id="newAdminUsername" class="form-control" placeholder="Username (optional)">
                    <button onclick="addAdminUser()" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Hinzuf√ºgen
                    </button>
                </div>
                <small style="color: #6c757d;">
                    <i class="fas fa-info-circle"></i> Rechtsklick auf User in Discord ‚Üí "Nutzer-ID kopieren"
                </small>
            </div>

            <!-- Admin-User Liste -->
            <div id="adminUsersList">
                <% if (adminUsers && adminUsers.length > 0) { %>
                    <div style="display: grid; gap: 15px;">
                        <% adminUsers.forEach(admin => { %>
                            <div style="background: <%= admin.isMainAdmin ? 'linear-gradient(135deg, rgb(102, 126, 234) 0%, rgb(118, 75, 162) 100%)' : 'rgba(26, 31, 58, 0.8)' %>; backdrop-filter: blur(10px); border: 2px solid <%= admin.isMainAdmin ? 'rgb(255, 215, 0)' : 'rgba(102, 126, 234, 0.3)' %>; border-radius: 10px; padding: 20px; color: white;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div style="flex: 1;">
                                        <h3 style="margin: 0 0 5px 0; <%= admin.isMainAdmin ? 'color: white;' : 'color: rgb(44, 47, 51);' %>">
                                            <% if (admin.isMainAdmin) { %>
                                                <i class="fas fa-crown" style="color: rgb(255, 215, 0);"></i> <%= admin.username || 'Haupt-Admin' %>
                                                <span style="background: rgba(255, 215, 0, 0.2); color: rgb(255, 215, 0); padding: 3px 10px; border-radius: 5px; font-size: 12px; margin-left: 10px; font-weight: 600;">
                                                    HAUPT-ADMIN
                                                </span>
                                            <% } else { %>
                                                <i class="fas fa-user"></i> <%= admin.username || 'Admin User' %>
                                            <% } %>
                                        </h3>
                                        <p style="font-family: monospace; <%= admin.isMainAdmin ? 'color: rgba(255, 255, 255, 0.8);' : 'color: rgb(108, 117, 125);' %> margin: 0 0 10px 0;"><%= admin.userId %></p>
                                        <small style="<%= admin.isMainAdmin ? 'color: rgba(255, 255, 255, 0.7);' : 'color: rgb(108, 117, 125);' %>">
                                            <% if (admin.isMainAdmin) { %>
                                                <i class="fas fa-shield-alt"></i> System-Administrator (Vollzugriff)
                                            <% } else { %>
                                                <i class="fas fa-calendar-plus"></i> Hinzugef√ºgt: <%= new Date(admin.addedAt).toLocaleString('de-DE') %>
                                            <% } %>
                                        </small>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <% if (!admin.isMainAdmin) { %>
                                            <button onclick="editAdminPermissions('<%= admin.userId %>')" class="btn btn-sm" style="background: #5865F2; color: white; padding: 8px 16px;">
                                                <i class="fas fa-key"></i> Berechtigungen
                                            </button>
                                            <button onclick="removeAdminUser('<%= admin.userId %>')" class="btn btn-sm" style="background: #ED4245; color: white; padding: 8px 16px;">
                                                <i class="fas fa-trash"></i> Entfernen
                                            </button>
                                        <% } else { %>
                                            <button class="btn btn-sm" style="background: rgba(255, 255, 255, 0.2); color: white; padding: 8px 16px; cursor: not-allowed;" disabled title="Haupt-Admin kann nicht bearbeitet werden">
                                                <i class="fas fa-lock"></i> Gesch√ºtzt
                                            </button>
                                        <% } %>
                                    </div>
                                </div>

                                <!-- Berechtigungen √úbersicht -->
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid <%= admin.isMainAdmin ? 'rgba(255, 255, 255, 0.2)' : 'rgb(240, 240, 240)' %>;">
                                    <strong style="<%= admin.isMainAdmin ? 'color: white;' : 'color: rgb(88, 101, 242);' %> display: block; margin-bottom: 10px;">
                                        <i class="fas fa-shield-alt"></i> <%= admin.isMainAdmin ? 'Alle Berechtigungen' : 'Aktive Berechtigungen' %>:
                                    </strong>
                                    <% if (admin.isMainAdmin) { %>
                                        <div style="background: rgba(255, 215, 0, 0.2); color: white; padding: 12px; border-radius: 8px; text-align: center;">
                                            <i class="fas fa-infinity"></i> <strong>Unbegrenzte Rechte</strong> - Vollzugriff auf alle Funktionen
                                        </div>
                                    <% } else { %>
                                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                            <% 
                                            const permNames = {
                                                viewAdminPanel: 'Admin-Panel',
                                                viewBotStatus: 'Bot-Status',
                                                restartBot: 'Bot Neustarten',
                                                manageCommands: 'Commands',
                                                viewLogs: 'Logs',
                                                toggleMaintenance: 'Wartungsmodus',
                                                toggleFeatures: 'Features',
                                                manageBypass: 'Bypass-Verwaltung',
                                                searchUsers: 'User Suche',
                                                viewUserStats: 'User-Stats',
                                                createBackup: 'Backup',
                                                viewBackups: 'Backups Anzeigen',
                                                cleanupDatabase: 'DB Bereinigung',
                                                sendAnnouncements: 'Ank√ºndigungen',
                                                sendBroadcast: 'Broadcast',
                                                viewBugReports: 'Bug Reports',
                                                manageBugReports: 'Bug-Verwaltung',
                                                viewGlobalStats: 'Statistiken',
                                                viewServerList: 'Server-Liste'
                                            };
                                            Object.entries(admin.permissions).forEach(([key, value]) => {
                                                if (value) {
                                            %>
                                            <span style="background: #e8f5e9; color: #2e7d32; padding: 5px 12px; border-radius: 6px; font-size: 13px; font-weight: 500;">
                                                <i class="fas fa-check"></i> <%= permNames[key] || key %>
                                            </span>
                                            <% 
                                                }
                                            });
                                            %>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div style="text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.6); background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); border-radius: 10px;">
                        <i class="fas fa-users-slash" style="font-size: 48px; opacity: 0.3;"></i>
                        <p style="margin-top: 15px;">Noch keine Admin-User hinzugef√ºgt</p>
                    </div>
                <% } %>
            </div>
        </div>
        <% } %>

        <% 
        // Helper-Funktion f√ºr Berechtigungspr√ºfung
        function hasPermission(perm) {
            return isMainAdmin || (permissions && permissions[perm]);
        }
        %>

        <% if (hasPermission('toggleMaintenance') || hasPermission('toggleFeatures')) { %>
        <!-- Wartungsmodus & Feature Control -->
        <div class="admin-card" style="border: 3px solid #ED4245;">
            <h2><i class="fas fa-shield-alt"></i> Globale Systemsteuerung</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                <i class="fas fa-exclamation-triangle" style="color: #ED4245;"></i>
                <strong>Achtung:</strong> Diese Einstellungen betreffen ALLE Server und alle Nutzer!
            </p>

            <!-- Wartungsmodus Toggle -->
            <div style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(237, 66, 69, 0.3); color: white; padding: 25px; border-radius: 10px; margin-bottom: 25px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <h3 style="margin: 0; color: #2C2F33;">
                            <i class="fas fa-tools"></i> Wartungsmodus
                        </h3>
                        <p style="color: #6c757d; margin: 5px 0 0 0; font-size: 14px;">
                            Deaktiviert alle Bot-Funktionen und Dashboard-Zugriff f√ºr alle User
                        </p>
                    </div>
                    <label class="switch" style="margin: 0;">
                        <input type="checkbox" id="maintenanceModeToggle">
                        <span class="slider round"></span>
                    </label>
                </div>
                
                <div id="maintenanceModeSettings" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label><i class="fas fa-comment"></i> Wartungs-Nachricht</label>
                        <textarea id="maintenanceModeMessage" class="form-control" rows="3" placeholder="Diese Nachricht sehen User wenn sie Commands nutzen wollen...">Der Bot befindet sich im Wartungsmodus. Bitte versuche es sp√§ter erneut.</textarea>
                    </div>
                    <button onclick="updateMaintenanceMode()" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> Wartungsmodus aktivieren
                    </button>
                </div>
                
                <div style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(88, 101, 242, 0.3); color: white; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong style="color: #5865F2;">
                        <i class="fas fa-user-shield"></i> Admin-Bypass Verwaltung:
                    </strong>
                    <p style="margin: 10px 0 15px 0; color: #6c757d; font-size: 14px;">
                        User mit Bypass-Rechten k√∂nnen den Bot auch im Wartungsmodus und bei deaktivierten Features nutzen.
                    </p>
                    
                    <!-- Self Bypass Toggle -->
                    <div style="background: rgba(26, 31, 58, 0.4); backdrop-filter: blur(10px); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #5865F2;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: #5865F2;">
                                    <i class="fas fa-user"></i> Dein Bypass-Status
                                </strong>
                                <p style="margin: 5px 0 0 0; color: #6c757d; font-size: 13px;">
                                    Aktiviere Bypass f√ºr deinen eigenen Account
                                </p>
                            </div>
                            <label class="switch" style="margin: 0;">
                                <input type="checkbox" id="selfBypassToggle" onchange="toggleSelfBypass()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Bypass User Liste -->
                    <div id="bypassUsersList" style="margin-bottom: 15px;">
                        <div style="text-align: center; padding: 10px; color: #6c757d;">
                            <i class="fas fa-spinner fa-spin"></i> Lade...
                        </div>
                    </div>
                    
                    <!-- User hinzuf√ºgen -->
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <input type="text" id="bypassUserId" class="form-control" placeholder="User-ID eingeben" style="flex: 1;" onkeypress="if(event.key==='Enter') addBypassUser()">
                        <button onclick="addBypassUser()" class="btn btn-primary" style="white-space: nowrap;">
                            <i class="fas fa-plus"></i> Hinzuf√ºgen
                        </button>
                    </div>
                    <small style="color: #6c757d; display: block; margin-top: 5px;">
                        <i class="fas fa-info-circle"></i> Rechtsklick auf User in Discord ‚Üí "Nutzer-ID kopieren"
                    </small>
                </div>
            </div>

            <!-- Feature Toggles -->
            <div style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; padding: 25px; border-radius: 10px;">
                <h3 style="margin: 0 0 15px 0; color: white;">
                    <i class="fas fa-toggle-on"></i> Feature-Kontrolle
                </h3>
                <p style="color: #6c757d; margin-bottom: 20px; font-size: 14px;">
                    Deaktiviere einzelne Features global f√ºr alle Server (z.B. bei Bugs oder Problemen)
                </p>
                
                <div id="featureToggles">
                    <div style="text-align: center; padding: 20px; color: #6c757d;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                        <p style="margin-top: 10px;">Lade Features...</p>
                    </div>
                </div>
            </div>
        </div>
        <% } %>

        <% if (hasPermission('viewBugReports')) { %>
        <!-- Bug Reports -->
        <div class="admin-card">
            <h2><i class="fas fa-bug"></i> Bug Reports</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                Alle gemeldeten Bugs von Usern - Setze Priorit√§ten und verwalte den Status
            </p>

            <!-- Filter & Stats -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px;">
                <div class="stat-box" style="background: linear-gradient(135deg, #ED4245 0%, #A02729 100%); padding: 15px;">
                    <div style="font-size: 14px; opacity: 0.9;">Offen</div>
                    <h3 style="font-size: 2em; margin: 5px 0;" id="bugStatsOpen">0</h3>
                </div>
                <div class="stat-box" style="background: linear-gradient(135deg, #FEE75C 0%, #F5A623 100%); padding: 15px;">
                    <div style="font-size: 14px; opacity: 0.9;">In Bearbeitung</div>
                    <h3 style="font-size: 2em; margin: 5px 0;" id="bugStatsInvestigating">0</h3>
                </div>
                <div class="stat-box" style="background: linear-gradient(135deg, #57F287 0%, #3BA55D 100%); padding: 15px;">
                    <div style="font-size: 14px; opacity: 0.9;">Behoben</div>
                    <h3 style="font-size: 2em; margin: 5px 0;" id="bugStatsFixed">0</h3>
                </div>
                <div class="stat-box" style="background: linear-gradient(135deg, #5865F2 0%, #4752C4 100%); padding: 15px;">
                    <div style="font-size: 14px; opacity: 0.9;">Gesamt</div>
                    <h3 style="font-size: 2em; margin: 5px 0;" id="bugStatsTotal">0</h3>
                </div>
            </div>

            <!-- Bug Reports Liste -->
            <div id="bugReportsList">
                <div style="text-align: center; padding: 40px; color: #6c757d;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 32px;"></i>
                    <p style="margin-top: 15px;">Lade Bug Reports...</p>
                </div>
            </div>
        </div>
        <% } %>

        <% if (hasPermission('restartBot') || hasPermission('manageCommands') || hasPermission('viewLogs')) { %>
        <!-- Schnelle Bot-Kontrolle -->
        <div class="admin-card">
            <h2><i class="fas fa-robot"></i> Bot Schnellzugriff</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                Wichtige Bot-Funktionen direkt steuern
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <button onclick="restartBot()" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px;">
                    <i class="fas fa-sync-alt"></i> Bot Neustarten
                </button>
                
                <button onclick="clearCache()" class="btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 15px;">
                    <i class="fas fa-broom"></i> Cache Leeren
                </button>
                
                <button onclick="syncCommands()" class="btn" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 15px;">
                    <i class="fas fa-terminal"></i> Commands Synchronisieren
                </button>
                
                <button onclick="showBotLogs()" class="btn" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 15px;">
                    <i class="fas fa-file-alt"></i> Bot Logs Anzeigen
                </button>
            </div>
            
            <div id="botLogsContainer" style="display: none; margin-top: 20px;">
                <h3><i class="fas fa-scroll"></i> Bot Logs (letzte 100 Zeilen)</h3>
                <div style="background: #1e1f22; color: #dcddde; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px;">
                    <pre id="botLogsContent" style="margin: 0; white-space: pre-wrap;">Lade Logs...</pre>
                </div>
            </div>
        </div>
        <% } %>

        <% if (hasPermission('searchUsers')) { %>
        <!-- User Verwaltung -->
        <div class="admin-card">
            <h2><i class="fas fa-users"></i> User Verwaltung</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                Suche und verwalte User-Daten
            </p>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="userSearchInput" placeholder="User-ID oder Username eingeben..." 
                       style="flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 5px;">
                <button onclick="searchUser()" class="btn" style="background: #5865F2; color: white; padding: 12px 30px;">
                    <i class="fas fa-search"></i> Suchen
                </button>
            </div>
            
            <div id="userSearchResults"></div>
        </div>
        <% } %>

        <% if (hasPermission('viewGlobalStats')) { %>
        <!-- Globale Statistiken -->
        <div class="admin-card">
            <h2><i class="fas fa-chart-bar"></i> Globale Statistiken</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                √úberblick √ºber alle Bot-Aktivit√§ten
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="stat-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fas fa-server" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <h3 id="totalServers">0</h3>
                    <div style="font-size: 14px;">Gesamt Server</div>
                </div>
                
                <div class="stat-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i class="fas fa-users" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <h3 id="totalUsers">0</h3>
                    <div style="font-size: 14px;">Gesamt User</div>
                </div>
                
                <div class="stat-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <i class="fas fa-ticket-alt" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <h3 id="totalTickets">0</h3>
                    <div style="font-size: 14px;">Gesamt Tickets</div>
                </div>
                
                <div class="stat-box" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <i class="fas fa-terminal" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <h3 id="totalCommands">0</h3>
                    <div style="font-size: 14px;">Commands Ausgef√ºhrt</div>
                </div>
            </div>
        </div>
        <% } %>

        <% if (hasPermission('createBackup') || hasPermission('viewBackups') || hasPermission('cleanupDatabase')) { %>
        <!-- Database Management -->
        <div class="admin-card">
            <h2><i class="fas fa-database"></i> Datenbank Verwaltung</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                Backup und Wiederherstellung der Datenbank
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <button onclick="createBackup()" class="btn" style="background: linear-gradient(135deg, #57F287 0%, #3BA55D 100%); color: white; padding: 15px;">
                    <i class="fas fa-download"></i> Backup Erstellen
                </button>
                
                <button onclick="showBackups()" class="btn" style="background: linear-gradient(135deg, #5865F2 0%, #4752C4 100%); color: white; padding: 15px;">
                    <i class="fas fa-history"></i> Backups Anzeigen
                </button>
                
                <button onclick="cleanupOldData()" class="btn" style="background: linear-gradient(135deg, #FEE75C 0%, #F5A623 100%); color: #000; padding: 15px;">
                    <i class="fas fa-trash-alt"></i> Alte Daten Bereinigen
                </button>
            </div>
            
            <div id="backupsList" style="display: none; margin-top: 20px;">
                <h3><i class="fas fa-folder"></i> Verf√ºgbare Backups</h3>
                <div id="backupsContent"></div>
            </div>
        </div>
        <% } %>

        <% if (hasPermission('sendAnnouncements')) { %>
        <!-- Wartungsank√ºndigung -->
        <div class="admin-card">
            <h2><i class="fas fa-tools"></i> Wartungsank√ºndigung</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                Sende eine Wartungsank√ºndigung an alle Log-Channels aller Server
            </p>

            <form id="maintenanceForm">
                <div class="form-group">
                    <label><i class="fas fa-heading"></i> Titel</label>
                    <input type="text" id="maintenanceTitle" class="form-control" placeholder="z.B. Geplante Wartungsarbeiten" required>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-align-left"></i> Nachricht</label>
                    <textarea id="maintenanceMessage" class="form-control" rows="4" placeholder="Beschreibe die Wartungsarbeiten..." required></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label><i class="fas fa-calendar-alt"></i> Startzeit</label>
                        <input type="datetime-local" id="maintenanceStart" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar-check"></i> Endzeit (gesch√§tzt)</label>
                        <input type="datetime-local" id="maintenanceEnd" class="form-control" required>
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-exclamation-triangle"></i> Schweregrad</label>
                    <div class="severity-selector">
                        <div class="severity-option severity-info active" data-severity="info">
                            <i class="fas fa-info-circle" style="font-size: 24px; display: block; margin-bottom: 5px;"></i>
                            <strong>Info</strong><br>
                            <small>Kleine Updates</small>
                        </div>
                        <div class="severity-option severity-warning" data-severity="warning">
                            <i class="fas fa-exclamation-triangle" style="font-size: 24px; display: block; margin-bottom: 5px;"></i>
                            <strong>Warnung</strong><br>
                            <small>Kurze Ausf√§lle</small>
                        </div>
                        <div class="severity-option severity-critical" data-severity="critical">
                            <i class="fas fa-times-circle" style="font-size: 24px; display: block; margin-bottom: 5px;"></i>
                            <strong>Kritisch</strong><br>
                            <small>L√§ngere Wartung</small>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px; font-size: 16px;">
                    <i class="fas fa-broadcast-tower"></i> Ank√ºndigung an alle Server senden
                </button>
            </form>

            <div id="maintenanceResult" style="margin-top: 20px; display: none;"></div>
        </div>
        <% } %>

        <% if (hasPermission('sendBroadcast')) { %>
        <!-- Global Broadcast -->
        <div class="admin-card">
            <h2><i class="fas fa-bullhorn"></i> Global Broadcast</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                Sende eine Nachricht an alle Server (w√§hle Channel-Typ)
            </p>

            <form id="broadcastForm">
                <div class="form-group">
                    <label><i class="fas fa-comment"></i> Nachricht</label>
                    <textarea id="broadcastMessage" class="form-control" rows="3" placeholder="Deine Nachricht..." required></textarea>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-hashtag"></i> Channel-Typ</label>
                    <select id="broadcastChannelType" class="form-control">
                        <option value="log">Log-Channels</option>
                        <option value="general">General/Willkommens-Channels</option>
                        <option value="all">Alle konfigurierten Channels</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-success" style="width: 100%; padding: 15px;">
                    <i class="fas fa-paper-plane"></i> Broadcast senden
                </button>
            </form>

            <div id="broadcastResult" style="margin-top: 20px; display: none;"></div>
        </div>
        <% } %>

        <% if (hasPermission('viewServerList')) { %>
        <!-- Server Liste -->
        <div class="admin-card">
            <h2><i class="fas fa-server"></i> Verbundene Server (<%= botStatus.guilds ? botStatus.guilds.length : 0 %>)</h2>
            <div class="guild-list">
                <% if (botStatus.guilds && botStatus.guilds.length > 0) { %>
                    <% botStatus.guilds.forEach(guild => { %>
                        <div class="guild-card">
                            <i class="fas fa-server" style="font-size: 2em; margin-bottom: 10px;"></i>
                            <h3><%= guild.name %></h3>
                            <p style="opacity: 0.8; font-size: 14px; margin-top: 5px;">
                                <i class="fas fa-users"></i> <%= guild.memberCount %> Mitglieder
                            </p>
                        </div>
                    <% }); %>
                <% } else { %>
                    <p style="color: #6c757d; text-align: center; grid-column: 1/-1;">Keine Server gefunden</p>
                <% } %>
            </div>
        </div>
        <% } %>

        <% if (hasPermission('restartBot')) { %>
        <!-- Bot Controls -->
        <div class="admin-card">
            <h2><i class="fas fa-sliders-h"></i> Bot Controls</h2>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                <button onclick="reloadBot()" class="btn btn-warning" style="padding: 15px;">
                    <i class="fas fa-sync-alt"></i> Commands neu laden
                </button>
                <button onclick="getBotStats()" class="btn btn-info" style="padding: 15px;">
                    <i class="fas fa-chart-bar"></i> Statistiken aktualisieren
                </button>
            </div>
        </div>
        <% } %>

        <% if (hasPermission('toggleFeatures')) { %>
        <!-- Global Feature Toggles -->
        <div class="admin-card">
            <h2><i class="fas fa-toggle-on"></i> Globale Feature-Verwaltung</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i> Deaktiviere Features f√ºr <strong>alle Server</strong> bei Bugs oder Wartungsarbeiten
            </p>

            <!-- Feature Toggles -->
            <div id="featureToggles" style="display: grid; gap: 15px;">
                <!-- Wird via JavaScript geladen -->
                <div style="text-align: center; padding: 20px; color: #6c757d;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                    <p style="margin-top: 10px;">Lade Features...</p>
                </div>
            </div>
        </div>
        <% } %>
    </div>

    <script>
        // Socket.IO Connection f√ºr Live-Updates
        const socket = io();
        
        socket.on('connect', () => {
            console.log('üì° WebSocket verbunden');
        });
        
        socket.on('disconnect', () => {
            console.log('üì° WebSocket getrennt');
        });
        
        // Wartungsmodus Live-Update
        socket.on('maintenance-mode-changed', (data) => {
            console.log('üîî Wartungsmodus ge√§ndert:', data.enabled);
            
            if (data.enabled) {
                // Zeige Benachrichtigung
                showMaintenanceNotification();
                
                // Lade Seite nach 2 Sekunden neu
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else {
                // Wartung beendet - Seite neu laden
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        });
        
        function showMaintenanceNotification() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ED4245 0%, #A02729 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease-out;
            `;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <i class="fas fa-tools" style="font-size: 24px;"></i>
                    <div>
                        <div style="font-size: 18px; margin-bottom: 5px;">üîß Wartungsmodus aktiviert</div>
                        <div style="font-size: 14px; opacity: 0.9;">Seite wird neu geladen...</div>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
        }

        let selectedSeverity = 'info';

        // Severity Auswahl
        document.querySelectorAll('.severity-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.severity-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                selectedSeverity = this.dataset.severity;
            });
        });

        // Wartungsank√ºndigung
        document.getElementById('maintenanceForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sende...';

            try {
                const response = await fetch('/admin/maintenance-announcement', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: document.getElementById('maintenanceTitle').value,
                        message: document.getElementById('maintenanceMessage').value,
                        startTime: document.getElementById('maintenanceStart').value,
                        endTime: document.getElementById('maintenanceEnd').value,
                        severity: selectedSeverity
                    })
                });

                const data = await response.json();
                const resultDiv = document.getElementById('maintenanceResult');
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #57F287; color: #000; padding: 15px; border-radius: 8px;">
                            <i class="fas fa-check-circle"></i> <strong>Erfolgreich!</strong><br>
                            Gesendet an ${data.sentTo} Server${data.failed > 0 ? `, ${data.failed} fehlgeschlagen` : ''}
                        </div>
                    `;
                    e.target.reset();
                } else {
                    throw new Error(data.error);
                }
                
                resultDiv.style.display = 'block';
            } catch (error) {
                document.getElementById('maintenanceResult').innerHTML = `
                    <div style="background: #ED4245; color: white; padding: 15px; border-radius: 8px;">
                        <i class="fas fa-times-circle"></i> <strong>Fehler:</strong> ${error.message}
                    </div>
                `;
                document.getElementById('maintenanceResult').style.display = 'block';
            }

            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-broadcast-tower"></i> Ank√ºndigung an alle Server senden';
        });

        // Global Broadcast
        document.getElementById('broadcastForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sende...';

            try {
                const response = await fetch('/admin/global-broadcast', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: document.getElementById('broadcastMessage').value,
                        channelType: document.getElementById('broadcastChannelType').value
                    })
                });

                const data = await response.json();
                const resultDiv = document.getElementById('broadcastResult');
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #57F287; color: #000; padding: 15px; border-radius: 8px;">
                            <i class="fas fa-check-circle"></i> Gesendet an ${data.sentTo} Server
                        </div>
                    `;
                    e.target.reset();
                } else {
                    throw new Error(data.error);
                }
                
                resultDiv.style.display = 'block';
            } catch (error) {
                document.getElementById('broadcastResult').innerHTML = `
                    <div style="background: #ED4245; color: white; padding: 15px; border-radius: 8px;">
                        <i class="fas fa-times-circle"></i> ${error.message}
                    </div>
                `;
                document.getElementById('broadcastResult').style.display = 'block';
            }

            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-paper-plane"></i> Broadcast senden';
        });

        // Bot neu laden
        async function reloadBot() {
            if (!confirm('Bot Commands neu laden?')) return;
            
            try {
                const response = await fetch('/admin/reload-bot', { method: 'POST' });
                const data = await response.json();
                alert(data.success ? 'Commands neu geladen!' : 'Fehler: ' + data.error);
            } catch (error) {
                alert('Fehler: ' + error.message);
            }
        }

        // Bot Statistiken
        async function getBotStats() {
            try {
                const response = await fetch('/admin/bot-stats');
                const data = await response.json();
                alert('Statistiken:\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                alert('Fehler: ' + error.message);
            }
        }

        // Feature Toggles laden
        async function loadFeatureToggles() {
            try {
                const response = await fetch('/admin/api/global-settings');
                const settings = await response.json();
                
                const container = document.getElementById('featureToggles');
                
                // Update Maintenance Mode Button
                updateMaintenanceModeUI(settings.maintenanceMode);
                
                // Feature Categories
                const categories = {
                    'Ticket-System': ['tickets', 'ticketPriority', 'ticketForward'],
                    'Moderation': ['warns', 'reports', 'ban', 'kick', 'clear'],
                    'Projekte & Verwaltung': ['projects', 'ports', 'news'],
                    'Kommunikation': ['twitch', 'vorschlag', 'kummerkasten'],
                    'Verifizierung & Rollen': ['verify', 'prefix'],
                    'Automation': ['scheduledMessages', 'autoRoles', 'customCommands'],
                    'Dashboard': ['dashboard']
                };
                
                const featureNames = {
                    tickets: 'üé´ Tickets',
                    ticketPriority: 'üî¥ Ticket-Priorit√§t',
                    ticketForward: '‚û°Ô∏è Ticket-Weiterleitung',
                    warns: '‚ö†Ô∏è Warn-System',
                    reports: 'üì¢ Report-System',
                    ban: 'üî® Ban',
                    kick: 'üë¢ Kick',
                    clear: 'üßπ Clear Messages',
                    projects: 'üéÆ Projekt-Management',
                    ports: 'üåê Port-Verwaltung',
                    news: 'üì∞ News',
                    vorschlag: 'üí° Vorschl√§ge',
                    kummerkasten: 'üì¨ Kummerkasten',
                    verify: '‚úÖ Verifizierung',
                    prefix: 'üè∑Ô∏è Auto-Prefixes',
                    scheduledMessages: '‚è∞ Geplante Nachrichten',
                    autoRoles: 'üé≠ Auto-Rollen',
                    customCommands: 'üîß Custom Commands',
                    dashboard: 'üìä Dashboard'
                };
                
                let html = '';
                
                for (const [category, features] of Object.entries(categories)) {
                    html += `
                        <div style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; padding: 20px; border-radius: 10px;">
                            <h3 style="margin: 0 0 15px 0; color: #5865F2;">
                                <i class="fas fa-layer-group"></i> ${category}
                            </h3>
                            <div style="display: grid; gap: 10px;">
                    `;
                    
                    features.forEach(feature => {
                        const featureData = settings.features[feature];
                        const enabled = featureData?.enabled ?? true;
                        const reason = featureData?.reason || '';
                        
                        html += `
                            <div style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px); border: 2px solid ${enabled ? 'rgba(87, 242, 135, 0.3)' : 'rgba(237, 66, 69, 0.3)'}; color: white; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <strong style="color: white;">${featureNames[feature] || feature}</strong>
                                    ${!enabled && reason ? `<br><small style="color: rgba(255, 255, 255, 0.6);">Grund: ${reason}</small>` : ''}
                                </div>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <span style="font-size: 12px; color: ${enabled ? '#57F287' : '#ED4245'}; font-weight: 600;">
                                        ${enabled ? '‚úÖ AKTIV' : '‚ùå DEAKTIVIERT'}
                                    </span>
                                    <button onclick="toggleFeature('${feature}', ${!enabled})" class="btn btn-sm" style="background: ${enabled ? '#ED4245' : '#57F287'}; color: white; padding: 8px 15px;">
                                        <i class="fas fa-${enabled ? 'ban' : 'check'}"></i> ${enabled ? 'Deaktivieren' : 'Aktivieren'}
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = html;
                
            } catch (error) {
                document.getElementById('featureToggles').innerHTML = `
                    <div style="background: #ED4245; color: white; padding: 15px; border-radius: 8px;">
                        <i class="fas fa-exclamation-triangle"></i> Fehler beim Laden: ${error.message}
                    </div>
                `;
            }
        }

        // Feature Toggle
        async function toggleFeature(featureName, enable) {
            let reason = '';
            
            if (!enable) {
                reason = prompt('Grund f√ºr Deaktivierung (wird Usern angezeigt):');
                if (reason === null) return; // Abgebrochen
            }
            
            const confirmMsg = enable 
                ? `M√∂chtest du "${featureName}" wieder aktivieren?`
                : `M√∂chtest du "${featureName}" f√ºr ALLE Server deaktivieren?\n\nGrund: ${reason}`;
            
            if (!confirm(confirmMsg)) return;
            
            try {
                const response = await fetch(`/admin/api/global-settings/feature/${featureName}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        enabled: enable,
                        reason: reason,
                        userId: '<%= user.id %>'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(enable ? '‚úÖ Feature aktiviert!' : '‚ùå Feature deaktiviert!');
                    loadFeatureToggles();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Beim Laden
        document.addEventListener('DOMContentLoaded', () => {
            loadGlobalSettings();
            loadBugReports();
            loadGlobalStats();
        });
        
        // Globale Statistiken laden
        async function loadGlobalStats() {
            try {
                const response = await fetch('/admin/stats/global');
                const data = await response.json();
                
                if (data.success && data.stats) {
                    document.getElementById('totalServers').textContent = data.stats.servers || 0;
                    document.getElementById('totalUsers').textContent = data.stats.users || 0;
                    document.getElementById('totalTickets').textContent = data.stats.tickets || 0;
                    document.getElementById('totalCommands').textContent = data.stats.commands || 0;
                }
            } catch (error) {
                console.error('Fehler beim Laden der Statistiken:', error);
            }
        }

        // Load Global Settings (Wartungsmodus + Features)
        async function loadGlobalSettings() {
            try {
                const response = await fetch('/admin/settings');
                const settings = await response.json();
                
                // Wartungsmodus UI aktualisieren
                const maintenanceToggle = document.getElementById('maintenanceModeToggle');
                maintenanceToggle.checked = settings.maintenanceMode;
                
                const maintenanceMessageField = document.getElementById('maintenanceModeMessage');
                if (maintenanceMessageField) {
                    maintenanceMessageField.value = settings.maintenanceMessage || '';
                }
                
                if (settings.maintenanceMode) {
                    const settingsDiv = document.getElementById('maintenanceModeSettings');
                    if (settingsDiv) {
                        settingsDiv.style.display = 'block';
                    }
                }
                
                // Feature Toggles laden
                loadFeatureToggles(settings.features);
                
                // Bypass User laden
                loadBypassUsers(settings.adminBypass || []);
                
                // Self-Bypass Toggle setzen
                const currentUserId = '<%= user.id %>';
                const selfBypassToggle = document.getElementById('selfBypassToggle');
                selfBypassToggle.checked = settings.adminBypass && settings.adminBypass.includes(currentUserId);
            } catch (error) {
                console.error('Fehler beim Laden der Settings:', error);
            }
        }

        // Bypass Users laden und anzeigen
        async function loadBypassUsers(bypassIds) {
            const container = document.getElementById('bypassUsersList');
            
            if (bypassIds.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 15px; color: rgba(255, 255, 255, 0.6); background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); border-radius: 8px;">
                        <i class="fas fa-user-slash"></i>
                        <p style="margin: 5px 0 0 0;">Keine Bypass-User konfiguriert</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            const currentUserId = '<%= user.id %>';
            
            for (const userId of bypassIds) {
                const isCurrent = userId === currentUserId;
                
                // Versuche User-Daten zu holen
                try {
                    const response = await fetch(`/api/user/${userId}`);
                    const userData = await response.json();
                    
                    html += `
                        <div class="bypass-user-item ${isCurrent ? 'current-user' : ''}">
                            <div class="bypass-user-info">
                                <img src="https://cdn.discordapp.com/avatars/${userId}/${userData.avatar}.png" 
                                     class="bypass-user-avatar" 
                                     onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'">
                                <div>
                                    <div class="bypass-user-name">
                                        ${userData.username || 'Unbekannt'}
                                        ${isCurrent ? '<span style="color: #57F287; margin-left: 8px;"><i class="fas fa-check-circle"></i> Du</span>' : ''}
                                    </div>
                                    <div class="bypass-user-id">${userId}</div>
                                </div>
                            </div>
                            <button 
                                class="bypass-remove-btn" 
                                onclick="removeBypassUser('${userId}')"
                                ${isCurrent ? 'disabled title="Du kannst dich nicht selbst entfernen"' : ''}>
                                <i class="fas fa-trash"></i> Entfernen
                            </button>
                        </div>
                    `;
                } catch (error) {
                    // User nicht gefunden - zeige nur ID
                    html += `
                        <div class="bypass-user-item ${isCurrent ? 'current-user' : ''}">
                            <div class="bypass-user-info">
                                <div style="width: 32px; height: 32px; background: #5865F2; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <div class="bypass-user-name">
                                        User nicht gefunden
                                        ${isCurrent ? '<span style="color: #57F287; margin-left: 8px;"><i class="fas fa-check-circle"></i> Du</span>' : ''}
                                    </div>
                                    <div class="bypass-user-id">${userId}</div>
                                </div>
                            </div>
                            <button 
                                class="bypass-remove-btn" 
                                onclick="removeBypassUser('${userId}')"
                                ${isCurrent ? 'disabled title="Du kannst dich nicht selbst entfernen"' : ''}>
                                <i class="fas fa-trash"></i> Entfernen
                            </button>
                        </div>
                    `;
                }
            }
            
            container.innerHTML = html;
        }

        // Bypass User hinzuf√ºgen
        async function addBypassUser() {
            const input = document.getElementById('bypassUserId');
            const userId = input.value.trim();
            
            if (!userId) {
                alert('‚ö†Ô∏è Bitte gib eine User-ID ein!');
                return;
            }
            
            // Validiere User-ID Format (nur Zahlen, 17-19 Zeichen)
            if (!/^\d{17,19}$/.test(userId)) {
                alert('‚ùå Ung√ºltige User-ID! Muss 17-19 Ziffern lang sein.');
                return;
            }
            
            try {
                const response = await fetch('/admin/admin-bypass', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, action: 'add' })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ User erfolgreich hinzugef√ºgt!');
                    input.value = '';
                    loadBypassUsers(data.adminBypass);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Bypass User entfernen
        async function removeBypassUser(userId) {
            const currentUserId = '<%= user.id %>';
            
            if (!confirm('‚ö†Ô∏è Bypass-Rechte f√ºr diesen User entfernen?')) {
                return;
            }
            
            try {
                const response = await fetch('/admin/admin-bypass', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, action: 'remove' })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ User erfolgreich entfernt!');
                    loadBypassUsers(data.adminBypass);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Self-Bypass Toggle
        async function toggleSelfBypass() {
            const selfBypassToggle = document.getElementById('selfBypassToggle');
            const currentUserId = '<%= user.id %>';
            const action = selfBypassToggle.checked ? 'add' : 'remove';
            
            try {
                const response = await fetch('/admin/admin-bypass', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: currentUserId, action })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(action === 'add' ? '‚úÖ Bypass aktiviert! Du hast jetzt Zugriff w√§hrend Wartungsmodus.' : '‚ö†Ô∏è Bypass deaktiviert! Du wirst bei Wartungsmodus blockiert.');
                    loadBypassUsers(data.adminBypass);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
                // Toggle zur√ºcksetzen bei Fehler
                selfBypassToggle.checked = !selfBypassToggle.checked;
            }
        }

        // Wartungsmodus Toggle
        document.getElementById('maintenanceModeToggle').addEventListener('change', function() {
            const settingsDiv = document.getElementById('maintenanceModeSettings');
            if (this.checked) {
                settingsDiv.style.display = 'block';
            } else {
                updateMaintenanceMode();
            }
        });

        // Wartungsmodus aktualisieren
        async function updateMaintenanceMode() {
            const enabled = document.getElementById('maintenanceModeToggle').checked;
            const message = document.getElementById('maintenanceModeMessage').value;
            
            if (!enabled || confirm(enabled ? '‚ö†Ô∏è Wartungsmodus aktivieren? Alle User verlieren Zugriff!' : 'Wartungsmodus deaktivieren?')) {
                try {
                    console.log('[Frontend] Sende Wartungsmodus-Request:', { enabled, message });
                    
                    const response = await fetch('/admin/toggle-maintenance', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ enabled, message })
                    });
                    
                    const data = await response.json();
                    
                    console.log('[Frontend] Response erhalten:', data);
                    
                    if (data.success) {
                        alert(enabled ? 'üîß Wartungsmodus AKTIVIERT! Bot-Status: Wartung' : '‚úÖ Wartungsmodus BEENDET!');
                        if (!enabled) {
                            document.getElementById('maintenanceModeSettings').style.display = 'none';
                        }
                        
                        // Lade Settings neu um sicherzustellen, dass UI synchron ist
                        setTimeout(() => loadGlobalSettings(), 500);
                    } else {
                        throw new Error(data.error);
                    }
                } catch (error) {
                    console.error('[Frontend] Fehler:', error);
                    alert('‚ùå Fehler: ' + error.message);
                    document.getElementById('maintenanceModeToggle').checked = !enabled;
                }
            } else {
                document.getElementById('maintenanceModeToggle').checked = !enabled;
            }
        }

        // Feature Toggles laden
        function loadFeatureToggles(features) {
            const container = document.getElementById('featureToggles');
            
            const featureNames = {
                tickets: { name: 'Ticket System', icon: 'fa-ticket-alt', desc: 'Ticket-Erstellung und Verwaltung' },
                ticketPriority: { name: 'Ticket-Priorit√§t', icon: 'fa-exclamation-circle', desc: '/priority Command' },
                ticketForward: { name: 'Ticket-Weiterleitung', icon: 'fa-share', desc: '/forward Command' },
                warns: { name: 'Warn-System', icon: 'fa-exclamation-triangle', desc: '/warn, /warns, /unwarn Commands' },
                reports: { name: 'Report-System', icon: 'fa-flag', desc: '/report Command' },
                ban: { name: 'Ban', icon: 'fa-ban', desc: '/ban Command' },
                kick: { name: 'Kick', icon: 'fa-shoe-prints', desc: '/kick Command' },
                clear: { name: 'Clear', icon: 'fa-broom', desc: '/clear Command' },
                projects: { name: 'Projekt-Management', icon: 'fa-folder', desc: '/projekt Commands' },
                ports: { name: 'Port-Verwaltung', icon: 'fa-network-wired', desc: '/port Commands' },
                news: { name: 'News', icon: 'fa-newspaper', desc: '/news Command' },
                vorschlag: { name: 'Vorschl√§ge', icon: 'fa-lightbulb', desc: '/vorschlag Command' },
                kummerkasten: { name: 'Kummerkasten', icon: 'fa-box', desc: 'Anonymer Chat' },
                verify: { name: 'Verifizierung', icon: 'fa-check-circle', desc: '/verify System' },
                prefix: { name: 'Auto-Prefixes', icon: 'fa-tag', desc: 'Nickname-Prefixes' },
                scheduledMessages: { name: 'Geplante Nachrichten', icon: 'fa-clock', desc: 'Scheduled Messages' },
                autoRoles: { name: 'Auto-Roles', icon: 'fa-user-tag', desc: 'Automatische Rollen' },
                customCommands: { name: 'Custom Commands', icon: 'fa-terminal', desc: 'Eigene Commands' },
                dashboard: { name: 'Dashboard', icon: 'fa-th-large', desc: 'Web-Dashboard Zugriff' }
            };
            
            let html = '';
            for (const [key, data] of Object.entries(featureNames)) {
                const feature = features[key] || { enabled: true, reason: '' };
                html += `
                    <div class="feature-item ${!feature.enabled ? 'disabled' : ''}">
                        <div class="feature-info">
                            <h4>
                                <i class="fas ${data.icon}"></i> ${data.name}
                            </h4>
                            <p>${data.desc}</p>
                            ${!feature.enabled && feature.reason ? `<p style="color: #ED4245; margin-top: 5px;"><strong>Grund:</strong> ${feature.reason}</p>` : ''}
                        </div>
                        <div class="feature-toggle-switch">
                            <label class="switch">
                                <input type="checkbox" ${feature.enabled ? 'checked' : ''} 
                                       onchange="toggleFeature('${key}', this.checked)">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // Feature umschalten
        async function toggleFeature(featureName, enabled) {
            let reason = '';
            
            if (!enabled) {
                reason = prompt('Grund f√ºr Deaktivierung (wird Usern angezeigt):');
                if (reason === null) {
                    // Cancelled - Revert toggle
                    event.target.checked = true;
                    return;
                }
            }
            
            try {
                const response = await fetch('/admin/toggle-feature', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ feature: featureName, enabled, reason })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(enabled ? `‚úÖ Feature "${featureName}" aktiviert!` : `‚ö†Ô∏è Feature "${featureName}" deaktiviert!`);
                    loadGlobalSettings(); // Reload
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
                event.target.checked = !enabled; // Revert
            }
        }

        // Bug Reports laden
        async function loadBugReports() {
            try {
                const response = await fetch('/admin/bug-reports');
                const reports = await response.json();
                
                // Statistiken aktualisieren
                document.getElementById('bugStatsTotal').textContent = reports.length;
                document.getElementById('bugStatsOpen').textContent = reports.filter(r => r.status === 'open').length;
                document.getElementById('bugStatsInvestigating').textContent = reports.filter(r => r.status === 'investigating').length;
                document.getElementById('bugStatsFixed').textContent = reports.filter(r => r.status === 'fixed').length;
                
                const container = document.getElementById('bugReportsList');
                
                if (reports.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 60px; color: #6c757d;">
                            <i class="fas fa-check-circle" style="font-size: 64px; opacity: 0.3;"></i>
                            <h3 style="margin-top: 20px;">Keine Bug Reports</h3>
                            <p>Aktuell wurden keine Bugs gemeldet.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div style="display: grid; gap: 20px;">';
                
                reports.forEach(report => {
                    const priorityColors = {
                        low: '#5865F2',
                        medium: '#FEE75C',
                        high: '#F5A623',
                        critical: '#ED4245'
                    };
                    
                    const priorityLabels = {
                        low: 'üü¢ Niedrig',
                        medium: 'üü° Mittel',
                        high: 'üü† Hoch',
                        critical: 'üî¥ Kritisch'
                    };
                    
                    const statusColors = {
                        open: '#ED4245',
                        investigating: '#FEE75C',
                        fixed: '#57F287',
                        closed: '#6c757d',
                        wontfix: '#99AAB5'
                    };
                    
                    const statusLabels = {
                        open: 'Offen',
                        investigating: 'In Bearbeitung',
                        fixed: 'Behoben',
                        closed: 'Geschlossen',
                        wontfix: 'Wird nicht behoben'
                    };
                    
                    html += `
                        <div style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px); border: 2px solid ${priorityColors[report.priority]}; color: white; border-radius: 10px; padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div style="flex: 1;">
                                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                                        <span style="background: rgba(26, 31, 58, 0.8); padding: 4px 12px; border-radius: 6px; font-family: monospace; font-size: 13px; font-weight: bold; color: white;">${report.id}</span>
                                        <span style="background: ${priorityColors[report.priority]}; color: white; padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 600;">${priorityLabels[report.priority]}</span>
                                        <span style="background: ${statusColors[report.status]}; color: white; padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 600;">${statusLabels[report.status]}</span>
                                    </div>
                                    <h3 style="margin: 0 0 10px 0; color: white;">${report.title}</h3>
                                    <p style="margin: 0 0 10px 0; color: rgba(255, 255, 255, 0.7); font-size: 14px;">${report.description}</p>
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 13px; color: rgba(255, 255, 255, 0.6);">
                                        <div><i class="fas fa-user"></i> ${report.username}</div>
                                        <div><i class="fas fa-server"></i> ${report.guildName}</div>
                                        <div><i class="fas fa-clock"></i> ${new Date(report.createdAt).toLocaleString('de-DE')}</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 10px; margin-left: 20px;">
                                    <button onclick="showBugDetails('${report.id}')" class="btn btn-sm" style="background: #5865F2; color: white; padding: 8px 16px;">
                                        <i class="fas fa-eye"></i> Details
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Quick Actions -->
                            <div style="display: flex; gap: 10px; padding-top: 15px; border-top: 1px solid #f0f0f0;">
                                <select onchange="updateBugPriority('${report.id}', this.value)" style="padding: 6px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                                    <option value="">Priorit√§t √§ndern...</option>
                                    <option value="low" ${report.priority === 'low' ? 'selected' : ''}>üü¢ Niedrig</option>
                                    <option value="medium" ${report.priority === 'medium' ? 'selected' : ''}>üü° Mittel</option>
                                    <option value="high" ${report.priority === 'high' ? 'selected' : ''}>üü† Hoch</option>
                                    <option value="critical" ${report.priority === 'critical' ? 'selected' : ''}>üî¥ Kritisch</option>
                                </select>
                                
                                <select onchange="updateBugStatus('${report.id}', this.value)" style="padding: 6px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                                    <option value="">Status √§ndern...</option>
                                    <option value="open" ${report.status === 'open' ? 'selected' : ''}>Offen</option>
                                    <option value="investigating" ${report.status === 'investigating' ? 'selected' : ''}>In Bearbeitung</option>
                                    <option value="fixed" ${report.status === 'fixed' ? 'selected' : ''}>Behoben</option>
                                    <option value="closed" ${report.status === 'closed' ? 'selected' : ''}>Geschlossen</option>
                                    <option value="wontfix" ${report.status === 'wontfix' ? 'selected' : ''}>Wird nicht behoben</option>
                                </select>
                                
                                <button onclick="deleteBugReport('${report.id}')" class="btn btn-sm" style="background: #ED4245; color: white; padding: 6px 12px; margin-left: auto;">
                                    <i class="fas fa-trash"></i> L√∂schen
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Fehler beim Laden der Bug Reports:', error);
                document.getElementById('bugReportsList').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ED4245;">
                        <i class="fas fa-exclamation-circle" style="font-size: 48px;"></i>
                        <p style="margin-top: 15px;">Fehler beim Laden der Bug Reports</p>
                    </div>
                `;
            }
        }

        // Bug Priority √§ndern
        async function updateBugPriority(id, priority) {
            if (!priority) return;
            
            try {
                const response = await fetch(`/admin/bug-reports/${id}/priority`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ priority })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Priorit√§t aktualisiert!');
                    loadBugReports();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Bug Status √§ndern
        async function updateBugStatus(id, status) {
            if (!status) return;
            
            const note = prompt('Optional: Notiz hinzuf√ºgen (wird dem User angezeigt):');
            
            try {
                const response = await fetch(`/admin/bug-reports/${id}/status`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status, note })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Status aktualisiert!');
                    loadBugReports();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Bug Details anzeigen
        function showBugDetails(id) {
            fetch(`/admin/bug-reports`)
                .then(res => res.json())
                .then(reports => {
                    const report = reports.find(r => r.id === id);
                    if (!report) return;
                    
                    let detailsHTML = `
                        <div style="max-width: 600px; color: white;">
                            <h2 style="margin-bottom: 20px; color: white;">${report.title}</h2>
                            
                            <div style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <strong>Bug-ID:</strong> ${report.id}<br>
                                <strong>Gemeldet von:</strong> ${report.username} (${report.userId})<br>
                                <strong>Server:</strong> ${report.guildName}<br>
                                <strong>Erstellt:</strong> ${new Date(report.createdAt).toLocaleString('de-DE')}<br>
                                <strong>Aktualisiert:</strong> ${new Date(report.updatedAt).toLocaleString('de-DE')}
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <strong>Beschreibung:</strong>
                                <p>${report.description}</p>
                            </div>
                    `;
                    
                    if (report.steps) {
                        detailsHTML += `
                            <div style="margin-bottom: 15px;">
                                <strong>Schritte zur Reproduktion:</strong>
                                <p style="white-space: pre-wrap;">${report.steps}</p>
                            </div>
                        `;
                    }
                    
                    if (report.expectedBehavior) {
                        detailsHTML += `
                            <div style="margin-bottom: 15px;">
                                <strong>Erwartetes Verhalten:</strong>
                                <p>${report.expectedBehavior}</p>
                            </div>
                        `;
                    }
                    
                    if (report.actualBehavior) {
                        detailsHTML += `
                            <div style="margin-bottom: 15px;">
                                <strong>Tats√§chliches Verhalten:</strong>
                                <p>${report.actualBehavior}</p>
                            </div>
                        `;
                    }
                    
                    if (report.notes && report.notes.length > 0) {
                        detailsHTML += `
                            <div style="margin-bottom: 15px;">
                                <strong>Notizen:</strong>
                                <div style="margin-top: 10px;">
                        `;
                        report.notes.forEach(note => {
                            detailsHTML += `
                                <div style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                                    <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">${new Date(note.timestamp).toLocaleString('de-DE')}</div>
                                    <div style="color: white;">${note.text}</div>
                                </div>
                            `;
                        });
                        detailsHTML += '</div></div>';
                    }
                    
                    detailsHTML += '</div>';
                    
                    // Zeige in einem Alert (oder sp√§ter in einem Modal)
                    const win = window.open('', 'Bug Details', 'width=700,height=800');
                    win.document.write(`
                        <html>
                        <head>
                            <title>Bug Report Details - ${report.id}</title>
                            <style>
                                body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 30px; }
                                h2 { color: #2C2F33; }
                                strong { color: #5865F2; }
                                p { color: #6c757d; line-height: 1.6; }
                            </style>
                        </head>
                        <body>${detailsHTML}</body>
                        </html>
                    `);
                });
        }

        // Bug Report l√∂schen
        async function deleteBugReport(id) {
            if (!confirm('‚ö†Ô∏è Bug Report wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!')) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/bug-reports/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Bug Report gel√∂scht!');
                    loadBugReports();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // === NEUE ADMIN FUNKTIONEN ===

        // Bot neustarten
        async function restartBot() {
            if (!confirm('‚ö†Ô∏è Bot wirklich neu starten? Dies kann einige Sekunden dauern.')) return;
            
            try {
                const response = await fetch('/admin/bot/restart', { method: 'POST' });
                const data = await response.json();
                alert(data.success ? '‚úÖ Bot wird neu gestartet...' : '‚ùå Fehler: ' + data.error);
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Cache leeren
        async function clearCache() {
            if (!confirm('‚ö†Ô∏è Cache wirklich leeren?')) return;
            
            try {
                const response = await fetch('/admin/bot/clear-cache', { method: 'POST' });
                const data = await response.json();
                alert(data.success ? '‚úÖ Cache geleert!' : '‚ùå Fehler: ' + data.error);
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Commands synchronisieren
        async function syncCommands() {
            if (!confirm('‚ö†Ô∏è Commands mit Discord synchronisieren?')) return;
            
            try {
                const response = await fetch('/admin/bot/sync-commands', { method: 'POST' });
                const data = await response.json();
                alert(data.success ? '‚úÖ Commands synchronisiert!' : '‚ùå Fehler: ' + data.error);
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Bot Logs anzeigen
        async function showBotLogs() {
            const container = document.getElementById('botLogsContainer');
            const content = document.getElementById('botLogsContent');
            
            if (container.style.display === 'block') {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            content.textContent = 'Lade Logs...';
            
            try {
                const response = await fetch('/admin/bot/logs');
                const data = await response.json();
                
                if (data.success) {
                    content.textContent = data.logs || 'Keine Logs verf√ºgbar';
                } else {
                    content.textContent = 'Fehler beim Laden der Logs';
                }
            } catch (error) {
                content.textContent = 'Fehler: ' + error.message;
            }
        }

        // User suchen
        async function searchUser() {
            const query = document.getElementById('userSearchInput').value.trim();
            const results = document.getElementById('userSearchResults');
            
            if (!query) {
                alert('‚ùå Bitte User-ID oder Username eingeben');
                return;
            }
            
            results.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Suche...</p>';
            
            try {
                const response = await fetch(`/admin/users/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.success && data.user) {
                    const user = data.user;
                    results.innerHTML = `
                        <div style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; padding: 20px; border-radius: 8px; margin-top: 15px;">
                            <h3 style="color: white;"><i class="fas fa-user"></i> ${user.username}</h3>
                            <p><strong>ID:</strong> ${user.id}</p>
                            <p><strong>Bot:</strong> ${user.bot ? 'Ja' : 'Nein'}</p>
                            <p><strong>Erstellt:</strong> ${new Date(user.createdTimestamp).toLocaleString('de-DE')}</p>
                            <div style="margin-top: 15px;">
                                <button onclick="banUser('${user.id}')" class="btn" style="background: #ED4245; color: white; margin-right: 10px;">
                                    <i class="fas fa-ban"></i> Bannen
                                </button>
                                <button onclick="getUserStats('${user.id}')" class="btn" style="background: #5865F2; color: white;">
                                    <i class="fas fa-chart-line"></i> Statistiken
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    results.innerHTML = '<p style="color: #ED4245;">‚ùå User nicht gefunden</p>';
                }
            } catch (error) {
                results.innerHTML = '<p style="color: #ED4245;">‚ùå Fehler: ' + error.message + '</p>';
            }
        }

        // Backup erstellen
        async function createBackup() {
            if (!confirm('üì¶ Backup der Datenbank erstellen?')) return;
            
            try {
                const response = await fetch('/admin/database/backup', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    alert(`‚úÖ Backup erstellt!\n\nDatei: ${data.filename}\nGr√∂√üe: ${data.size}`);
                } else {
                    alert('‚ùå Fehler: ' + data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // User-Statistiken abrufen
        async function getUserStats(userId) {
            const results = document.getElementById('userSearchResults');
            results.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Lade Statistiken...</p>';
            
            try {
                const response = await fetch(`/admin/users/${userId}/stats`);
                const data = await response.json();
                
                if (data.success && data.stats) {
                    const stats = data.stats;
                    let html = `
                        <div style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; padding: 25px; border-radius: 10px; margin-top: 15px;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <img src="${stats.user.avatar}" style="width: 64px; height: 64px; border-radius: 50%;" />
                                <div>
                                    <h2 style="margin: 0; color: white;">${stats.user.username}</h2>
                                    <p style="margin: 5px 0; color: rgba(255, 255, 255, 0.7);">ID: ${stats.user.id}</p>
                                    <p style="margin: 5px 0; color: rgba(255, 255, 255, 0.7);">Account-Alter: ${stats.user.accountAge}</p>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px; border-radius: 8px;">
                                    <h4 style="margin: 0 0 10px 0;">üé´ Tickets</h4>
                                    <p style="font-size: 24px; font-weight: bold; margin: 0;">${stats.tickets.total}</p>
                                    <small>Offen: ${stats.tickets.open} | Geschlossen: ${stats.tickets.closed}</small>
                                </div>
                                
                                <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 15px; border-radius: 8px;">
                                    <h4 style="margin: 0 0 10px 0;">‚ö†Ô∏è Warnungen</h4>
                                    <p style="font-size: 24px; font-weight: bold; margin: 0;">${stats.warnings.total}</p>
                                    <small>Aktiv: ${stats.warnings.active} | Entfernt: ${stats.warnings.removed}</small>
                                </div>
                                
                                <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 15px; border-radius: 8px;">
                                    <h4 style="margin: 0 0 10px 0;">üõ°Ô∏è Moderation</h4>
                                    <p style="margin: 5px 0; font-size: 14px;">Warns: ${stats.moderation.warns}</p>
                                    <p style="margin: 5px 0; font-size: 14px;">Kicks: ${stats.moderation.kicks}</p>
                                    <p style="margin: 5px 0; font-size: 14px;">Bans: ${stats.moderation.bans}</p>
                                </div>
                            </div>
                            
                            <h3 style="margin: 20px 0 10px 0; color: white;"><i class="fas fa-server"></i> Server (${stats.guilds.count})</h3>
                            <div style="display: grid; gap: 10px; max-height: 300px; overflow-y: auto;">
                    `;
                    
                    stats.guilds.list.forEach(guild => {
                        html += `
                            <div style="background: rgba(26, 31, 58, 0.6); padding: 15px; border-radius: 8px; border-left: 4px solid #5865F2;">
                                <strong style="color: white;">${guild.name}</strong>
                                <p style="margin: 5px 0; color: rgba(255, 255, 255, 0.7); font-size: 13px;">
                                    Beigetreten: ${new Date(guild.joinedAt).toLocaleDateString('de-DE')}
                                </p>
                                <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px;">
                                    ${guild.roles.slice(0, 5).map(role => `
                                        <span style="background: ${role.color}; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px;">
                                            ${role.name}
                                        </span>
                                    `).join('')}
                                    ${guild.roles.length > 5 ? `<span style="color: rgba(255, 255, 255, 0.6); font-size: 11px;">+${guild.roles.length - 5} weitere</span>` : ''}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                            <button onclick="searchUser()" class="btn" style="background: #5865F2; color: white; margin-top: 20px; width: 100%;">
                                <i class="fas fa-arrow-left"></i> Zur√ºck zur Suche
                            </button>
                        </div>
                    `;
                    
                    results.innerHTML = html;
                } else {
                    results.innerHTML = '<p style="color: #ED4245;">‚ùå Statistiken konnten nicht geladen werden</p>';
                }
            } catch (error) {
                results.innerHTML = '<p style="color: #ED4245;">‚ùå Fehler: ' + error.message + '</p>';
            }
        }

        // Backups anzeigen
        async function showBackups() {
            const container = document.getElementById('backupsList');
            const content = document.getElementById('backupsContent');
            
            if (container.style.display === 'block') {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            content.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Lade Backups...</p>';
            
            try {
                const response = await fetch('/admin/database/backups');
                const data = await response.json();
                
                if (data.success && data.backups.length > 0) {
                    content.innerHTML = data.backups.map(backup => `
                        <div style="background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; padding: 15px; border-radius: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: white;">${backup.filename}</strong><br>
                                <small style="color: rgba(255, 255, 255, 0.7);">${backup.size} - ${backup.date}</small>
                            </div>
                            <button onclick="restoreBackup('${backup.filename}')" class="btn" style="background: #5865F2; color: white;">
                                <i class="fas fa-undo"></i> Wiederherstellen
                            </button>
                        </div>
                    `).join('');
                } else {
                    content.innerHTML = '<p>Keine Backups gefunden</p>';
                }
            } catch (error) {
                content.innerHTML = '<p style="color: #ED4245;">‚ùå Fehler: ' + error.message + '</p>';
            }
        }

        // Alte Daten bereinigen
        async function cleanupOldData() {
            if (!confirm('‚ö†Ô∏è Alte Daten bereinigen?\n\n- Geschlossene Tickets (√§lter als 30 Tage)\n- Abgelehnte Applications\n- Alte Logs')) return;
            
            try {
                const response = await fetch('/admin/database/cleanup', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    alert(`‚úÖ Bereinigung abgeschlossen!\n\n${data.removed} Eintr√§ge entfernt`);
                } else {
                    alert('‚ùå Fehler: ' + data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Globale Stats laden
        async function loadGlobalStats() {
            try {
                const response = await fetch('/admin/stats/global');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalServers').textContent = data.stats.servers || 0;
                    document.getElementById('totalUsers').textContent = data.stats.users || 0;
                    document.getElementById('totalTickets').textContent = data.stats.tickets || 0;
                    document.getElementById('totalCommands').textContent = data.stats.commands || 0;
                }
            } catch (error) {
                console.error('Fehler beim Laden der globalen Stats:', error);
            }
        }

        // Stats beim Laden aktualisieren
        document.addEventListener('DOMContentLoaded', () => {
            loadGlobalStats();
            // Alle 30 Sekunden aktualisieren
            setInterval(loadGlobalStats, 30000);
        });

        // === ADMIN USER MANAGEMENT ===

        // Admin-User hinzuf√ºgen
        async function addAdminUser() {
            const userIdInput = document.getElementById('newAdminUserId');
            const usernameInput = document.getElementById('newAdminUsername');
            const userId = userIdInput.value.trim();
            const username = usernameInput.value.trim();

            if (!userId) {
                alert('‚ö†Ô∏è Bitte User-ID eingeben!');
                return;
            }

            // Validiere User-ID Format
            if (!/^\d{17,19}$/.test(userId)) {
                alert('‚ùå Ung√ºltige User-ID! Muss 17-19 Ziffern lang sein.');
                return;
            }

            // Standard-Berechtigungen: Nur Admin-Panel sehen
            const permissions = {
                viewAdminPanel: true,
                viewBotStatus: true,
                viewGlobalStats: true,
                viewServerList: true
            };

            try {
                const response = await fetch('/admin/admin-users/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, username, permissions })
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Admin-User erfolgreich hinzugef√ºgt!\n\nDer User kann nun das Admin-Panel sehen.\nBerechtigungen k√∂nnen jetzt bearbeitet werden.');
                    userIdInput.value = '';
                    usernameInput.value = '';
                    window.location.reload();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Admin-User entfernen
        async function removeAdminUser(userId) {
            if (!confirm('‚ö†Ô∏è Admin-User wirklich entfernen?\n\nDer User verliert sofort alle Admin-Berechtigungen!')) {
                return;
            }

            try {
                const response = await fetch(`/admin/admin-users/${userId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Admin-User entfernt!');
                    window.location.reload();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                alert('‚ùå Fehler: ' + error.message);
            }
        }

        // Admin-Berechtigungen bearbeiten
        function editAdminPermissions(userId) {
            // Erstelle Permissions-Dialog
            fetch('/admin/admin-users')
                .then(res => res.json())
                .then(data => {
                    const admin = data.adminUsers.find(a => a.userId === userId);
                    if (!admin) return;

                    const permissionGroups = {
                        'Bot Verwaltung': {
                            viewBotStatus: 'Bot-Status anzeigen',
                            restartBot: 'Bot neustarten',
                            manageCommands: 'Commands verwalten',
                            viewLogs: 'Logs anzeigen'
                        },
                        'Wartung & Features': {
                            toggleMaintenance: 'Wartungsmodus umschalten',
                            toggleFeatures: 'Features aktivieren/deaktivieren',
                            manageBypass: 'Bypass-User verwalten'
                        },
                        'User Verwaltung': {
                            searchUsers: 'User suchen',
                            viewUserStats: 'User-Statistiken anzeigen'
                        },
                        'Datenbank': {
                            createBackup: 'Backups erstellen',
                            viewBackups: 'Backups anzeigen',
                            cleanupDatabase: 'Datenbank bereinigen'
                        },
                        'Kommunikation': {
                            sendAnnouncements: 'Wartungsank√ºndigungen senden',
                            sendBroadcast: 'Global Broadcast senden'
                        },
                        'Bug Reports': {
                            viewBugReports: 'Bug Reports anzeigen',
                            manageBugReports: 'Bug Reports verwalten'
                        },
                        'Statistiken': {
                            viewGlobalStats: 'Globale Statistiken anzeigen',
                            viewServerList: 'Server-Liste anzeigen'
                        }
                    };

                    let html = `
                        <div style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
                            <h2 style="margin-bottom: 20px;">
                                <i class="fas fa-key"></i> Berechtigungen f√ºr ${admin.username || admin.userId}
                            </h2>
                            <p style="color: #6c757d; margin-bottom: 20px;">
                                W√§hle die Berechtigungen aus, die dieser Admin-User haben soll:
                            </p>
                    `;

                    for (const [groupName, perms] of Object.entries(permissionGroups)) {
                        html += `
                            <div style="background: rgba(26, 31, 58, 0.6); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h3 style="margin: 0 0 15px 0; color: #5865F2; font-size: 16px;">
                                    ${groupName}
                                </h3>
                                <div style="display: grid; gap: 10px;">
                        `;

                        for (const [key, label] of Object.entries(perms)) {
                            const checked = admin.permissions[key] ? 'checked' : '';
                            html += `
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: rgba(26, 31, 58, 0.8); backdrop-filter: blur(10px); border: 2px solid rgba(102, 126, 234, 0.2); color: white; border-radius: 6px;">
                                    <input type="checkbox" id="perm_${key}" ${checked} style="cursor: pointer; width: 18px; height: 18px;">
                                    <span style="flex: 1;">${label}</span>
                                </label>
                            `;
                        }

                        html += `
                                </div>
                            </div>
                        `;
                    }

                    html += `
                            <div style="display: flex; gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 2px solid #ddd;">
                                <button onclick="saveAdminPermissions('${userId}')" class="btn" style="flex: 1; background: #57F287; color: #000; padding: 12px; font-weight: 600;">
                                    <i class="fas fa-save"></i> Speichern
                                </button>
                                <button onclick="window.close()" class="btn" style="background: #6c757d; color: white; padding: 12px;">
                                    <i class="fas fa-times"></i> Abbrechen
                                </button>
                            </div>
                        </div>
                    `;

                    const win = window.open('', 'Admin Berechtigungen', 'width=800,height=700');
                    win.document.write(`
                        <html>
                        <head>
                            <title>Admin Berechtigungen - ${admin.username || admin.userId}</title>
                            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                            <style>
                                body { 
                                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                                    padding: 30px;
                                    background: #f8f9fa;
                                }
                                h2, h3 { color: #2C2F33; }
                                .btn {
                                    border: none;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    font-size: 14px;
                                    transition: opacity 0.3s;
                                }
                                .btn:hover { opacity: 0.9; }
                            </style>
                        </head>
                        <body>${html}</body>
                        </html>
                    `);

                    // F√ºge Funktion zum Child-Window hinzu
                    win.saveAdminPermissions = async function(userId) {
                        const permissions = {};
                        
                        // Sammle alle Berechtigungen
                        for (const group of Object.values(permissionGroups)) {
                            for (const key of Object.keys(group)) {
                                const checkbox = win.document.getElementById('perm_' + key);
                                if (checkbox) {
                                    permissions[key] = checkbox.checked;
                                }
                            }
                        }

                        // viewAdminPanel muss immer true sein
                        permissions.viewAdminPanel = true;

                        try {
                            const response = await fetch(`/admin/admin-users/${userId}/permissions`, {
                                method: 'PATCH',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ permissions })
                            });

                            const data = await response.json();

                            if (data.success) {
                                alert('‚úÖ Berechtigungen aktualisiert!');
                                win.close();
                                window.location.reload();
                            } else {
                                throw new Error(data.error);
                            }
                        } catch (error) {
                            alert('‚ùå Fehler: ' + error.message);
                        }
                    };
                });
        }

        // Partikel Animation
        const canvas = document.getElementById('particles');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const particles = [];
        const particleCount = 100;
        const maxDistance = 150;
        
        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.radius = Math.random() * 2 + 1;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                
                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(102, 126, 234, 0.8)';
                ctx.fill();
            }
        }
        
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }
        
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });
            
            // Verbindungslinien
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < maxDistance) {
                        const opacity = (1 - distance / maxDistance) * 0.5;
                        ctx.beginPath();
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.strokeStyle = `rgba(102, 126, 234, ${opacity})`;
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                }
            }
            
            requestAnimationFrame(animate);
        }
        
        animate();
        
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>

    <footer style="margin-top: 50px; padding: 30px 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); text-align: center;">
        <div style="max-width: 1400px; margin: 0 auto; padding: 0 20px;">
            <p style="margin: 0; color: white; font-size: 14px;">&copy; 2025 TTH-Bot Dashboard ‚Ä¢ Made with <i class="fas fa-heart" style="color: #ff6b6b;"></i> by Thunderflash007</p>
        </div>
    </footer>
</body>
</html>
